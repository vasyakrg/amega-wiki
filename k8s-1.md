---
title: Свой k8s - ШАГ 1
description: Минимум, что бы поднять свой k8s на коленке
published: true
date: 2019-12-30T07:05:26.117Z
tags: 
---

# Шаг 1
Поднимем свой k8s на Rancher используя быстрый [Hetzner Cloud](https://console.hetzner.cloud/), поднимем пустое Ceph хранилище. 

>Регистрация и создание нод под весь проект
{.is-success}


Для начала, надо зарегистрироваться на [Hetzner Cloud](https://console.hetzner.cloud/) и создать пустой проект.
Кредитную карту они не просят навязчиво, как другие облачные провайдеры. У меня недавно в биллинг обнаружился счет двух месячной давности, который я забыл оплатить - при этом, все работало и никто ничего не отключал. Достаточно лояльные ребята.
Можно кстати подвязать свой PayPal и вообще не светить данные карты (для ребят с шапочкой из фольги), а так же прикрутить 2FA (рекомендую)

Создаем тестовый проект и идет в создание серверов. 

>Поднимаем будущее хранилище
{.is-success}

Нам нужны три одинаковых сервера. Выбираем самый дешевый CX11 за 2.49  в месяц, выбираем ОС Ubuntu-1804, прикручиваем сразу свой ssh-ключ, что бы потом не было мороки с доступом. Задаем имя node-1. 
В поле кол-во серверов - ставим 3. Все остальное пока оставляем как есть. Нажимаем Create & Bay now.

> Ребята гордятся тем, что ноды создаются в течение 10 секунд - магия, блин :)
> 
Теперь идем в раздел Volumes, создаем 3 волума по 10Гб каждый (больше нам не надо, данные мы все равно хранить так не будем). При создании каждого волума желательно задавать ему номер соответствующий ноде, к которой вы его цепляете. Туту же выбираем куда цеплять и оставляем EXT4 систему по умолчанию. Пока на все это не очень важно.

По итогу: имеет 3 ноды node1\2\3 и три подключенных к ним волума volume-1\2\3

>Поднимаем ноды для rancher кластера
{.is-success}

Оговорюсь, что в тесте мы будем использовать 3 ноды, на которых будем хранить все данные и службы кластера.

Таким же макаром создаем три ноды, выбирая тариф CX-21, а ОС так же Ubuntu-1804. Волумы там не нужны, ssh-key не забудьте прикрепить свой. Именуем их как k8s-1\2\3 соотвественно.

> Если после создания серверов вам на почту пришло письмо с паролем, то вы забыли прикрепить ssh-key. Удалить такой сервер (а если он с подключенным волумом, но сначала удалите волум) и пересоздайте снова. Проблем будет меньше.
{.is-info}

По итогу: имеем 3 ноды с волумами по 10Гб для будущего хранилища Ceph, 3 ноды для кластера k8s с rancher

---
>Запускаем rancher
{.is-success}

Для начала нам надо на всех k8s-n нодах получить рабочий docker. Если масса вариантов, от банальной `apt  install docker.io`, когда на выходе вы получите старую 18.09 версию, до [маунала](https://www.linode.com/docs/applications/containers/install-docker-ce-ubuntu-1804/), коих много и все как один. Используйте его, а можно прокатить моим ansible-скриптом, он даст больше возможностей при начальной установке

Идем на первую ножу k8s-1 по shh

> `ssh root@ip` - где ip можно подсмотреть в веб-консоли Hetzner





