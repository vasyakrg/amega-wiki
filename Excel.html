<!--
title: Excel тормозит.
description: Excel тормозит и подвешивает машину по оперативке. Что делать?
published: true
date: 2020-11-25T16:17:37.468Z
tags: excel
editor: ckeditor
dateCreated: 2020-11-25T16:17:37.468Z
-->

<p>Итак, имеем жалобы на работу ПК при открытии файлов Excel, как правило от финансистов и бухгалтеров. В файле Excel всего 100 строк, но нормально работать с ним невозможно. Ячейки выделяются с ощутимой задержкой. При открытии файла процесс <strong>Excel съедает в районе 500-800 и более мегабайт</strong> оперативной памяти и ряд других симптомов, не позволяющих нормально работать с документом. При этом файл, который должен весить несколько килобайт, весит многие мегабайты.</p>
<p>Это побочный эффект копирования, возникает при вставке данных целыми листами или столбцами/строками из файлов, созданных 1С и подобных (ERP) систем: они генерируют в файл «пустые» ячейки (забитые пробелами), объекты типа “Надпись” и прочий непонятный мусор. В итоге со временем файл становится очень большим.</p>
<p>Стандартный способ посмотреть это (<strong>как делать НЕ НАДО, “подвесите” машину еще больше</strong>):<br>В Excel2003: меню Правка → Перейти → Выделить → Объекты.<br>В Excel2007: вкладка Главная → Найти и выделить → Выделение группы ячеек → Объекты.</p>
<h1>Способ решения №1 (умный и познавательный)</h1>
<p>Итак, имеем &nbsp;проблемный файл Excel. Заходим в Макросы и создаем следующий (кто не умеет - Гугл в помощь):</p>
<p>Sub Shapes_Count() &nbsp;</p>
<p>MsgBox "Автофигур: " &amp; ActiveSheet.Shapes.Count &nbsp;</p>
<p>End Sub</p>
<p>Выполняем, и помним, что макрос действует не на всю книгу, а на активный лист, так что нужно прогонять на каждом листе. В моём случае оказался оооочень тяжелый документ, <strong>один из листов</strong> дал такой результат :</p>
<figure class="image"><img src="/qip_shot_-_screen_021.jpg"></figure>
<p>И видим тот самый мусор, который жрёт оперативку. Снова идем в макросы и создаем следующий:</p>
<p>Sub DeleteAllTextBox()</p>
<p>Dim oSh As Shape</p>
<p>For Each oSh In ActiveSheet.Shapes</p>
<p>oSh.Delete</p>
<p>Next oSh</p>
<p>End Sub</p>
<p>Запускаем, ждём (в моём случае минут 5 ушло), проверяем первым макросом и результат:</p>
<figure class="image"><img src="/qip_shot_-_screen_022.jpg"></figure>
<p>&nbsp;</p>
<p>Закрываем файл - сохраняем, открывается без ошибок, нагрузка на ОЗУ падает в <strong>десять &nbsp;раз</strong>.<br>Чудеса, не правда ли?!</p>
<p>Перечитали пару, поумнели, попробовали, получили оргазм и благодарности от пользователей и забыли!</p>
<h2>Способ второй! Простой и не требует носить с собой макросы.</h2>
<p>Если кто не знал (я не знал): Стандартный формат рабочих книг Excel 2007 в действительности это сжатый ZIP-архив каталога XML-документов. Является заменой бывшего бинарного формата .xls, хотя и не поддерживает макросы по соображениям безопасности. Так что, берем файл и открываем его с помощью WinRAR, предварительно сделав копию (вдруг что-то пойдет не так). Ищем папку drawings (лежит в папке xl):</p>
<figure class="image"><img src="/qip_shot_-_screen_023.jpg"></figure>
<p>&nbsp;и удаляем её!</p>
<p>Запускаем файл, он ругнется пару раз, со всем соглашаемся и пересохраняем! Всё, все счастливы!</p>
<h3>P.S. Странно, что Microsoft знают об этом более 8 лет и ничего не исправляют….</h3>
