---
title: k8s + Ceprh
description: Подключаем хранилище в кластер
published: true
date: 2020-01-03T05:44:56.987Z
tags: 
---

# Шаг 4
Теперь, когда кластер работает, а хранилище видит свою емкость, осталось подключить одно к другому

Сначала работаем со стороны хранилища
Нужно сгенерить (получать) пароли и создать начальный пул для k8s

Создаем пул для данных с именем `kube` (команду запускаем на node1 хранилища)

> `ceph osd pool create kube 32 8`

32 и 8 - это `pg` и `pgs`, соответственно. Более точную размерность можно выбрать с помощью [калькулятора](https://ceph.io/pgcalc/), она зависит от размера кластера. В нашем тестовом задании - остаьте как есть.

Теперь создаем подключение и доступы к нему.

> `ceph auth add client.kube mon 'allow r' osd 'allow rwx pool=kube'`

Получаем ключ клиента

> ceph auth get-key client.kube

и админиский ключ

> ceph auth get client.admin 2>&1 |grep "key = " |awk '{print  $3'}

Со стороны хранилища все, идем в k8s-node1 и дальше будем работать с ней

