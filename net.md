---
title: Общее по сети
description: 
published: true
date: 2019-12-26T08:30:38.804Z
tags: 
---

# Мапирование портов
*У нас всегда есть два составляющих: source (источник) и destinations (приемник)*

рассмотрим простую задачу:
у нас есть модем с белым айпи наружу, есть какие-то внутренние ресурсы, например docker-host машина (10.10.10.68), у которой открыт порт 22 (ssh), на который без проблем цепляемся сидя в локальной сети

## задача: надо получить доступ извне к внутренней службе
подзадача: сесурити надо учитывать..

**Рализация такая:**

> доменное имя: у нас же есть внешнее доменное имя, которое ссылается на внешний адрес модема ?
{.is-success}

1. если нет - идем в панель управления доменными именами (провайдер, хостер, наша биллинг панель и прочее, и прописываем там записи А-типа, которые обычно выглядит так `docker.amegaserver.com A 178.98.247.42`
2. доменное имя есть - проверяем, что работает - `ping docker.amegaserver.com`. Пингуется наш внешний адрес ? Ок.  

> Торчащие наружу порты основных служб - это беда для нас и радость для злодеев
{.is-success}

1. идем на модем (керио, роутер, что угодно, что соединяет внешнюю сеть с внутренней и транслирует пакеты) и ищем там понятие `port-mapping` (port-forward, транслятор портов, опубликание служб и тому подобное)
2. смотрим там на возможности: обычно можно указать три переменных:
- `внешний порт` (external port) - у нас это какой-нить выдуманный (не стандартный) порт ssh службы - например 8022
- `внутренний порт` (dest port, internal port) - у нас это порт на котором нас ждут - 22 (ssh)
- `внутренний адрес` (dest ip, internal ip) - у нас по заданию это 10.10.10.68
3. может быть еще быть внешний адрес (source ip) - это дает возможность ограничить внешние хосты, которые смогут пользоваться данным правилом. Например можно указать свой домашний (статичный, белый) адрес в этом поле и доступ на внешний порт 8022 будет только из вашего дома.
4. прописываем цепочку
- `exretnal_ip`=0.0.0.0 (любой внешний хост) 
- `external_port`=8022 (внешний порт)
- `internal_ip`=10.10.10.68 (внутренний хост, куда идем)
- `internal_port`=22 (внутренний реальный порт, на котором висит и ждет нас служба)

> Тестирование:
{.is-success}

1. еще раз пингуем `ping docker.amegaserver.com`
2. проверяем, отвечает ли порт `telnet docker.amegaserver.com 8022`
обычно видим что-то типа
```
Trying 146.158.64.42...
Connected to docker.vigroup.kz.
Escape character is '^]'.
SSH-2.0-OpenSSH_7.6p1 Ubuntu-4ubuntu0.3
```

3. пробуем цепляться `ssh login@docker.amegaserver.com`
попросит логин (или не попросит, если на хосте там уже просажен ваш ssh-pub ключ)

